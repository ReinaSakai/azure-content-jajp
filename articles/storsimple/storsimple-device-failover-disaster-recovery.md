<properties 
   pageTitle="StorSimple のフェールオーバーと障害復旧 | Microsoft Azure"
   description="StorSimple デバイスを、そのデバイス自体、別の物理デバイス、または別の仮想デバイスにフェールオーバーする方法について説明します。"
   services="storsimple"
   documentationCenter=""
   authors="alkohli"
   manager="carmonm"
   editor="" />
<tags 
   ms.service="storsimple"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="09/16/2016"
   ms.author="alkohli" />

# StorSimple デバイスのフェールオーバーと障害復旧

## 概要

このチュートリアルでは、障害が発生した場合の StorSimple デバイスのフェールオーバーに必要な手順について説明します。フェールオーバーにより、データをデータ センターのソース デバイスから、同じ場所または別の場所にある物理デバイスや仮想デバイスに移行できます。

デバイスのフェールオーバーは障害復旧 (DR) 機能によって調整され、**[デバイス]** ページから開始されます。このページには、StorSimple Manager サービスに接続されているすべての StorSimple デバイスの一覧が表示されます。デバイスごとに、表示名、状態、プロビジョニング容量と最大容量、種類、およびモデルが表示されます。

![[デバイス] ページ](./media/storsimple-device-failover-disaster-recovery/IC740972.png)

このチュートリアルのガイダンスは、StorSimple 物理および仮想デバイスのすべてのソフトウェア バージョンに適用されます。



## 障害復旧 (DR) とデバイスのフェールオーバー

障害復旧 (DR) シナリオでは、プライマリ デバイスの機能が停止します。この場合、プライマリ デバイスを*ソース*として使用し、別のデバイスを*ターゲット*に指定することにより、障害が発生したデバイスに関連付けられているクラウドのデータを別のデバイスに移動できます。ターゲット デバイスに移行するボリューム コンテナーを 1 つ以上選択できます。このプロセスを*フェールオーバー*といいます。

フェールオーバー時には、ソース デバイスのボリューム コンテナーの所有権が変更され、ターゲット デバイスに転送されます。ボリューム コンテナーは所有権が変更されるとソース デバイスから削除されます。削除が完了すると、ターゲット デバイスはフェールバックできるようになります。

通常は、DR の後に最新のバックアップを使用してターゲット デバイスにデータが復元されます。ただし、同じボリュームに複数のバックアップ ポリシーがある場合、ボリューム数が最も多いバックアップ ポリシーが選択され、そのポリシーの最新のバックアップを使用してターゲット デバイスでデータが復元されます。

たとえば、*defaultPol* と *customPol* の 2 つのバックアップ ポリシー (1 つは既定、もう 1 つはカスタム) があるとします。各バックアップ ポリシーの詳細は次のとおりです。

- *defaultPol*: 1 つのボリューム (*vol1*) が午後 10 時 30 分から毎日実行される。
- *customPol*: 4 つのボリューム (*vol1*、*vol2*、*vol3*、*vol4*) が午後 10 時から毎日実行される。

この場合、クラッシュ整合性を確保するために、ボリューム数が多い *customPol* が優先的に使用されます。このポリシーの最新のバックアップを使用してデータが復元されます。


## デバイスのフェールオーバーに関する考慮事項

障害が発生した場合、StorSimple デバイスを次のデバイスに対してフェールオーバーできます。

- 物理デバイス
- StorSimple デバイス自体
- 仮想デバイス

どのデバイスにフェールオーバーする場合も、次の点に注意してください。

- DR の前提条件は、ボリューム コンテナー内のすべてのボリュームがオフラインであることと、ボリューム コンテナーにクラウド スナップショットが関連付けられていることです。
- DR に使用できるターゲット デバイスは、選択したボリューム コンテナーに対応できるだけの十分な領域があるデバイスです。
- サービスに接続されていても、十分な空き領域の条件を満たしていないデバイスは、ターゲット デバイスとして使用できません。
- DR に続く一定期間、データ アクセス パフォーマンスが重大な影響を受ける可能性があります。デバイスがクラウドのデータにアクセスしてローカルに保存する必要があるためです。

#### ソフトウェアのバージョン間でのデバイスのフェールオーバー

デプロイ中の StorSimple Manager サービスに物理デバイスと仮想デバイスの両方があり、それぞれが実行しているソフトウェアのバージョンが異なっている場合があります。ソフトウェアのバージョンによって、デバイスのボリュームの種類も異なっている可能性があります。たとえば、Update 2 以降を実行中のデバイスには、ローカル固定ボリュームと (アーカイブが階層のサブセットである) 階層化ボリュームがある可能性があります。一方、Update 2 より前のデバイスには、階層化ボリュームとアーカイブ ボリュームがある場合があります。

次の表を使用して、異なるバージョンのソフトウェアを実行中のデバイスへのフェールオーバーの可否と DR 中のボリュームの動作を確認してください。

| フェールオーバー元 | 物理デバイスで可能 | 仮想デバイスで可能 |
|----------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
| Update 2 ～ Update 1 より前 (リリース 0.1、0.2、0.3) | いいえ | いいえ |
| Update 2 ～ Update 1 (1、1.1、1.2) | はい <br></br>ローカル固定ボリューム、階層化ボリューム、または 2 種類を混在させて使用している場合、ボリュームは常に階層化ボリュームとしてフェールオーバーされます。 | はい<br></br>ローカル固定ボリュームを使用している場合、ボリュームは階層化ボリュームとしてフェールオーバーされます。 |
| Update 2 ～ Update 2 (以降のバージョン) | はい<br></br>ローカル固定ボリューム、階層化ボリューム、または 2 種類を混在させて使用している場合、ボリュームは常に開始ボリュームの種類と同じようにフェールオーバーされます。つまり、階層化ボリュームは階層化ボリュームとして、ローカル固定ボリュームはローカル固定ボリュームとしてフェールオーバーされます。 | はい<br></br>ローカル固定ボリュームを使用している場合、ボリュームは階層化ボリュームとしてフェールオーバーされます。 |


#### ソフトウェアのバージョン間での部分的なフェールオーバー

Update 1 より前を実行している StorSimple ソース デバイスを使用して、Update 1 以降を実行しているターゲットへの部分的なフェールオーバーを実行する場合は、このガイダンスに従ってください。


| 部分的なフェールオーバー元 | 物理デバイスで可能 | 仮想デバイスで可能 |
|----------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
|Update 1 より前 (リリース 0.1、0.2、0.3) から Update 1 以降 | 可能。ベスト プラクティスのヒントについては下記を参照。 | 可能。ベスト プラクティスのヒントについては下記を参照。 |


>[AZURE.TIP] Update 1 以降のバージョンで、クラウド メタデータとデータ形式の変更がありました。そのため、Update 1 より前のバージョンから Update 1 以降のバージョンへの部分的なフェールオーバーはお勧めできません。部分的なフェールオーバーを実行する必要がある場合は、まず両方のデバイス (ソースとターゲット) で Update 1 以降を適用してから、フェールオーバーを実行することをお勧めします。

## 別の物理デバイスにフェールオーバーする

ターゲットの物理デバイスにデバイスを復元するには、次の手順を実行します。

1. フェールオーバーするボリューム コンテナーにクラウド スナップショットが関連付けられていることを確認します。

1. **[デバイス]** ページで **[ボリューム コンテナー]** タブをクリックします。

1. 別のデバイスにフェールオーバーするボリューム コンテナーを選択します。ボリューム コンテナーをクリックし、このコンテナー内のボリュームの一覧を表示します。ボリュームを選択し、**[オフラインにする]** をクリックしてボリュームをオフラインにします。ボリューム コンテナーのすべてのボリュームでこのプロセスを繰り返します。

1. 別のデバイスにフェールオーバーするすべてのボリューム コンテナーで前の手順を繰り返します。

1. **[デバイス]** ページで、**[フェールオーバー]** をクリックします。

1. 表示されるウィザードの **[フェールオーバーするボリューム コンテナーを選択する]** で、次の手順を実行します。

	1. ボリューム コンテナーの一覧から、フェールオーバーするボリューム コンテナーを選択します。**関連付けられたクラウド スナップショットとオフラインのボリュームを含むボリューム コンテナーのみが表示されます。**

	1. 選択したコンテナーのボリュームの **[ターゲット デバイスを選択する]** で、利用できるデバイスの一覧からターゲット デバイスを選択します。利用できる容量があるデバイスのみが一覧に表示されます。

	1. 最後に、**[フェールオーバーの確認]** ですべてのフェールオーバー設定を見直します。チェック マーク アイコン ![チェック マーク アイコン](./media/storsimple-device-failover-disaster-recovery/IC740895.png) をクリックします。

1. フェールオーバー ジョブが作成され、これを **[ジョブ]** ページで監視できます。フェールオーバーしたボリューム コンテナーにローカル ボリュームが含まれている場合は、コンテナー内の (階層化されたボリュームではなく) ローカル ボリュームごとに個別の復元ジョブが表示されます。ローカル ボリュームの復元ジョブが完了するにはかなりの時間がかかるため、フェールオーバー ジョブの方が先に完了する可能性があります。これらのボリュームがローカルで保証されるためには、復元ジョブが完了している必要がある点に注意してください。フェールオーバーが完了したら、**[デバイス]** ページに移動します。

	1. フェールオーバー プロセスのターゲット デバイスとして使用されたデバイスを選択します。

	1. **[ボリューム コンテナー]** ページに移動します。すべてのボリューム コンテナーと古いデバイスのボリュームの一覧が表示されます。

## 1 台のデバイスを使用してフェールオーバーする

1 台のデバイスのみでフェールオーバーを実行する必要がある場合は、次の手順を実行します。

1. デバイスにあるすべてのボリュームのクラウド スナップショットを取得します。

1. デバイスを工場出荷時の既定値にリセットします。[StorSimple デバイスを工場出荷時の既定の設定にリセットする方法](storsimple-manage-device-controller.md#reset-the-device-to-factory-default-settings)に関するページの詳細な指示に従います。

1. StorSimple Manager サービスでデバイスを構成して再登録します。

1. **[デバイス]** ページで、古いデバイスは **"オフライン"** と表示されます。新しく登録されたデバイスは **"オンライン"** と表示されます。

1. 新しいデバイスの場合は、最初にデバイスの最小構成を完了します。
												
	>[AZURE.IMPORTANT] **最初に最小構成を完了しないと、現在の実装にバグがあるため DR は失敗します。この動作は、今後のリリースで修正される予定です。**

1. 古いデバイス (オフラインの状態) を選択し、**[フェールオーバー]** をクリックします。表示されるウィザードでこのデバイスをフェールオーバーし、ターゲット デバイスを新しく登録されたデバイスに指定します。詳細な手順については、「[別の物理デバイスにフェールオーバーする](#fail-over-to-another-physical-device)」を参照してください。

1. デバイスの復元ジョブが作成され、**[ジョブ]** ページから監視できます。

1. ジョブが正常に完了したら、新しいデバイスにアクセスし、**[ボリューム コンテナー]** ページに移動します。これで、すべてのボリューム コンテナーが古いデバイスから新しいデバイスに移行されます。

## StorSimple 仮想デバイスにフェールオーバーする

この手順を実行する前に、StorSimple 仮想デバイスを作成して構成する必要があります。Update 2 を実行している場合は、64 TB (テラバイト) を備え、Premium Storage を使用する 8020 仮想デバイスを DR で使用することを検討してください。
 
ターゲットの StorSimple 仮想デバイスにデバイスを復元するには、次の手順を実行します。

1. フェールオーバーするボリューム コンテナーにクラウド スナップショットが関連付けられていることを確認します。

1. **[デバイス]** ページで **[ボリューム コンテナー]** タブをクリックします。

1. 別のデバイスにフェールオーバーするボリューム コンテナーを選択します。ボリューム コンテナーをクリックし、このコンテナー内のボリュームの一覧を表示します。ボリュームを選択し、**[オフラインにする]** をクリックしてボリュームをオフラインにします。ボリューム コンテナーのすべてのボリュームでこのプロセスを繰り返します。

1. 別のデバイスにフェールオーバーするすべてのボリューム コンテナーで前の手順を繰り返します。

1. **[デバイス]** ページで、**[フェールオーバー]** をクリックします。

1. 表示されるウィザードの **[フェールオーバーするボリューム コンテナーを選択する]** で、次の手順を実行します。
													
	a.ボリューム コンテナーの一覧から、フェールオーバーするボリューム コンテナーを選択します。

	**関連付けられたクラウド スナップショットとオフラインのボリュームを含むボリューム コンテナーのみが表示されます。**

	b.**[選択したコンテナーのボリュームのターゲット デバイスを選択する]** で、利用できるデバイスの一覧から StorSimple 仮想デバイスを選択します。**十分な容量があるデバイスのみが一覧に表示されます。**
	

1. 最後に、**[フェールオーバーの確認]** ですべてのフェールオーバー設定を見直します。チェック マーク アイコン ![チェック マーク アイコン](./media/storsimple-device-failover-disaster-recovery/IC740895.png) をクリックします。

1. フェールオーバーが完了したら、**[デバイス]** ページに移動します。
													
	a.フェールオーバー プロセスのターゲット デバイスとして使用された StorSimple 仮想デバイスを選択します。
	
	b.**[ボリューム コンテナー]** ページに移動します。すべてのボリューム コンテナーと古いデバイスのボリュームの一覧が表示されます。

![ビデオ](./media/storsimple-device-failover-disaster-recovery/Video_icon.png) **ビデオ**

フェールオーバーした物理デバイスをクラウドの仮想デバイスに復元する方法について説明したビデオについては、[こちら](https://azure.microsoft.com/documentation/videos/storsimple-and-disaster-recovery/)を参照してください。


## フェールバック

Update 3 以降のバージョンの場合、StorSimple ではフェールバックもサポートされます。フェールオーバーが完了すると、以下の操作が行われます。

- フェールオーバーされたボリューム コンテナーは、ソース デバイスから削除されます。

- ボリューム コンテナーごとのバックグラウンド ジョブ (フェールオーバー) は、ソース デバイスで開始されます。ジョブの実行中にフェールバックしようとすると、そのことに関する通知を受け取ります。フェールバックを開始するには、ジョブが完了するまで待機する必要があります。

	ボリューム コンテナーの削除が完了するまでの時間は、データ量、データの経過時間、バックアップの数、および操作に使用可能なネットワーク帯域幅などのさまざまな要因によって異なります。テスト フェールオーバー/フェールバックを計画している場合は、データの少ない (GB) ボリューム コンテナーをテストすることをお勧めします。ほとんどの場合、フェールオーバーが完了した 24 時間後に、フェールバックを開始できます。




## よく寄せられる質問

Q.**DR が失敗したり、部分的に成功した場合はどうなりますか?**

A.DR が失敗した場合、もう一度試してみることをお勧めします。2 回目には、DR は 1 回目に何が実行され、プロセスがいつ停止したかを把握しています。DR プロセスは、その時点から開始されます。

Q.**デバイスのフェールオーバーが進行中にデバイスを削除することはできますか?**

A.DR の進行中にデバイスを削除することはできません。DR の完了後にのみデバイスを削除できます。

Q.**ソース デバイス上のローカル データを削除するために、ソース デバイスでガベージ コレクションが開始されるのはいつですか?**

A.ガベージ コレクションは、デバイスが完全にクリーンアップされた後にのみ、ソース デバイスで有効なります。クリーンアップには、ソース デバイスからフェールオーバーされたオブジェクト (ボリューム、バックアップ オブジェクト (データではない)、ボリューム コンテナー、ポリシーなど) のクリーンアップも含まれます。

Q.**ソース デバイスのボリューム コンテナーに関連付けられた削除ジョブが失敗するとどうなりますか?**

A.削除ジョブが失敗した場合、ボリューム コンテナーの削除を手動でトリガーする必要があります。**[デバイス]** ページで、目的のソース デバイスを選択し、**[ボリューム コンテナー]** をクリックします。フェールオーバーしたボリューム コンテナーをページ下部で選択し、**[削除]** をクリックします。ソース デバイス上のフェールオーバーしたすべてのボリューム コンテナー削除したら、フェールバックを開始できるようになります。

## ビジネス継続性障害復旧 (BCDR)

ビジネス継続性障害復旧 (BCDR) シナリオは、Azure データセンター全体が機能を停止したときに発生します。このような状況が発生すると、StorSimple Manager サービスと関連する StorSimple デバイスに影響が及ぶ可能性があります。

障害が発生する直前に登録された StorSimple デバイスがある場合は、これらの StorSimple デバイスを工場出荷時の設定に戻すことが必要になることがあります。障害の発生後、StorSimple デバイスはオフラインとして表示されます。このポータルから StorSimple デバイスを削除した後、設定を工場出荷時の設定に戻し、再度登録する必要があります。


## 次のステップ

- フェールオーバーの実行後、必要に応じて [StorSimple デバイスを非アクティブ化または削除](storsimple-deactivate-and-delete-device.md)します。

- StorSimple Manager サービスを使用する方法については、「[StorSimple Manager サービスを使用した StorSimple デバイスの管理](storsimple-manager-service-administration.md)」を参照してください。
 

<!---HONumber=AcomDC_0921_2016-->